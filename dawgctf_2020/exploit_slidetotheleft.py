'''
Welcome to the AES-CBC oracle!
Our oracle's function is AES-CBC.
The oracle is found at umbccd.io:13372, and your methods are:
    flg - returns the encrypted flag
    enc - returns the encryption of the message after the : in "enc:..."
          as 16 bytes of initialization vector followed by the ciphertext.
    dec - returns the decryption of the ciphertext after the : in "dec:<16 bytes iv>..."
          as a bytes string.
'''
from pwn import *

p = remote('crypto.ctf.umbccd.io', 13373)

p.send('flg')
ctxt = p.recv(1024)
print(repr(ctxt))

print('-'*5)
blocks = [ctxt[i*16:(i+1)*16] for i in range(len(ctxt)/16)]

p.send('enc:a')
plain = p.recv(1024)
print(repr(plain))
p.send('dec:'+plain)
ctxt2 = p.recv(1024)
print(repr(ctxt2))

print('-'*5)

iv = plain[0:16]

ptxt = ''

for block in blocks:
    p.send('dec:' + iv + block + '\x00'*16*15)
    resp = p.recv(1024)
    print(repr(resp))
    ptxt += resp[0:16]
    iv = block

print(repr(ptxt))

#p.interactive()

'''
'\xfd$\xbe^\x8fDY\x12\xfd"\xf0\x82\xb2\x96A\xbb\x8a\\\xd2\xdf\xf7\x15\x8clB\x15\x0f\xcc\xab\x1a\xc1\xb5#(\xa8\xd6\xec\x04\xa0j\x02\xb2no\xa4k\x88\x9f\n2\xd5\x92\xd0\xb0\x12w\xa5\x978\xa5\x8d\xed\x9d\xd6\xc8\x06Tp\xda\x93\x11\xa76\xeb,\x03\xb7\xd8%\xe0\xf9\xd9\x04BU\xc0+\xaf\x8d\xdb\xbeD\xa9\xc5\xa7\x97,O\xe2m\xaf\xa5b\'\xdb\xc5\xb1e\xbf\xd9&\x15'
-----
'\xfd$\xbe^\x8fDY\x12\xfd"\xf0\x82\xb2\x96A\xbb1\xd1a\xe3\x01P\xf2=;\r[\x89\x06A\x8aZ'
'a'
-----
'\x80\xceoAgH`\xa1\xab\xf1B\x15\x84Vs\xf2\xe6\xdbW\xd1\x8a\x7f\xadTZ\xc6>\x8b\xdb\x03\n=\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4'
'DawgCTF{@_Ch4IN_\x91\xa3;P\xf2.x*\xe5\xf1\xc1\xc5\xc2\x8f\x8a3\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4'
'i2_N0_S7R0n93R_78\xd7AY\xe9?T,\xa5V\xa0f\xcd\xfe\xc3\x19\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4'
'H4N_i72_W34k3S7_\x11\xcd<\x1d\xd5\x8b\xe61\x02s\xf6\xac\xe4x\xd6P\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4'
'L!NK_4nD_lif3_!2\xd3\xf9\xbd\xff\xdf\xa8\xe5\xe1\x91\x0f\xe2\n\xdeMnf\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4'
'_Af73r_4Ll_@_Ch4\xe2&\xed\xcdP\xfb\xdf\xe9*?pM\xc0P\xec\x11\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4'
'IN.}\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c7\xb0\x0b\xe2\xaa\x9e\x96a|!\x7fl\xd6Lm\x93\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4\xce\ti\x95K\x86\x1b\xff\xe9\x8f\x05;\xf4F\xa7\xe4'
'\x80\xceoAgH`\xa1\xab\xf1B\x15\x84Vs\xf2DawgCTF{@_Ch4IN_i2_N0_S7R0n93R_7H4N_i72_W34k3S7_L!NK_4nD_lif3_!2_Af73r_4Ll_@_Ch4IN.}\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c'
'''
