'''
Welcome to the AES-CTR oracle!
Our oracle's function is AES-GCM.
Our oracle has a consistent header.
The oracle is found at umbccd.io:13376, and your methods are:
    flg - returns the 16 byte nonce followed by the encrypted and authenticated flag
    enc - returns the encryption of the message after the : in "enc:..." with
          the first 16 bytes interpreted to be the nonce, which is represented
          as a 16 byte nonce followed by the authenticated ciphertext (16b tag)
    dec - returns the decryption of the authenticated ciphertext after the : in 
          "dec:<16 byte nonce>..." as a bytes string.
'''

from pwn import *

p = remote('crypto.ctf.umbccd.io', 13376)

p.send('flg')
ctxt = p.recv(1024)
print(repr(ctxt))
blocks = [ctxt[i*16:(i+1)*16] for i in range(len(ctxt)/16)]

print('-'*5)

#iv = '\x00' * 16
iv = ctxt[0:16]

p.send('enc:'+iv+'\x00'*16)
plain = p.recv(1024)
print(repr(plain))
p.send('dec:'+plain)
ctxt2 = p.recv(1024)
print(repr(ctxt2))

print('-'*5)

p.send('enc:'+iv+'\x00'*len(ctxt))
plain = p.recv(1024)
print(repr(plain))
p.send('dec:'+plain)
ctxt2 = p.recv(1024)
print(repr(ctxt2))

print('-'*5)

print(repr(''.join([chr(ord(x)^ord(y)) for x, y in zip(ctxt[16:], plain[16:])])))

'''
'\xc9\x94%\x9f\x1d\xc2\xcd4[>\x1bs\x00\xac\xb4k\x97\xc8H\xd0\xf1\xc7\xf1\xf5\xc4 \xb4(\x83\x11}%Z\x9f\x90\x04\x94^\x1c\x80~\x841\x03o\xe1\xfc\x9f$\xdb!\x95\xef\xa2\x12\xc6\xf7\x87\x18I\xca\x19\xaa!H\x99\x05\x17>%\xc4\x18\n\xc3'
-----
"\xc9\x94%\x9f\x1d\xc2\xcd4[>\x1bs\x00\xac\xb4k\xd3\xa9?\xb7\xb2\x93\xb7\x8e\xf7V\x87Z\xfasMA\xe5\xa7g[{SI\xcf@O'd./s\xd1"
'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'
-----
'\xc9\x94%\x9f\x1d\xc2\xcd4[>\x1bs\x00\xac\xb4k\xd3\xa9?\xb7\xb2\x93\xb7\x8e\xf7V\x87Z\xfasMA#\xc0\xf3h\xd4.C\xf9N\xf1C\\\x07\xc7\x8f\xbe\x0e\xb8M\xd5\x9f\x88j\xf5\xc4\xfa\xb00\xb2"\x98\xe8"\x17\xc2\xc5\x7f\x80\xca\nt\xadT\xf1\xa8V\xbf53\xae\x02\nya\xb4\xc7\x9d\x01k\xador\xa0R\x9f\x01EKf\x90\x0f\xdd\xf0%'
'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'
-----
'DawgCTF{3v3ryb0dy_cl@p_y0ur_h&s!*cl@p*x33}\xa8yx;2\xc9j\x8e\xc7\xd2A\xa5\x0e\x12~n'
'''
