
const char pass[] = "this_is_a_very_long_password_i_bet_you_can't_even_enter_all_of_it";

int level_1() {
    char local_pass[sizeof pass]; // ebp - 0x5e
    char input[0x37]; // ebp - 0x95
    int ret; // ebp - 0xa0
    memcpy(local_pass, pass, sizeof pass); // inlined
    printf("password> ");
    fflush(stdout);
    /*
    >>> len("this_is_a_very_long_password_i_bet_you_can't_even_enter_all_of_it")
    65
    >>> 0x37
    55
    >>> hex(65)
    '0x41'
    */
    // some sort of initialization happens here (inlined memset, probably)
    read(input, 0x36, stdin);
    input[strcspn(input, "\r\n")] = 0;
    putchar('\n');
    check_password_1(input, local_pass, 0, ret);
    printf("MAIN_OUT %d\n", ret);
    return ret;
}

void check_password_1(char* input, char* local_pass, int index, int* outer_ret) {
    // cookie immdiately after buf
    char buf[0x20]; // ebp - 0x2c
    int ret = 0; // ebp - 0x30
    //char* input; // ebp - 0x3c
    //char* local_pass; // ebp - 0x40
    char j = index;  // ebp - 0x44
    //int* outer_ret; // ebp - 0x4c
    memset(buf, 0, sizeof buf); // inlined
    if(input[j] == local_pass[j]) {
        if(strlen(local_pass) < j) {
            ret = 1;
        } else {
            check_password_1(input, local_pass, j+1, &ret);
            memcpy(buf, input, strlen(input)); // overflow here
        }
    } else {
        printf("FAIL! %c != %c\n", input[j], local_pass[j]);
    }
    *outer_ret = ret;
}
