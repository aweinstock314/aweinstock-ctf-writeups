/*
│      ││   0x080488a6      6a00           pushl $0
│      ││   0x080488a8      e863fcffff     calll sym.imp.time
│      ││   0x080488ad      83c410         addl $0x10, %esp
│      ││   0x080488b0      3d80466858     cmpl $0x58684680, %eax
│     ┌───< 0x080488b5      7507           jne 0x80488be
│     │││   0x080488b7      e81ffeffff     calll sym.admin
│     │└──< 0x080488bc      ebe5           jmp 0x80488a3
---
*/

char buff[0x40];
char ip[0x20];
int DEBUG = 1;

void admin() {
/*
[0x080487be]> f~admin
0x080486db 25 sym.admin
*/
    system("sh");
}

int main() {
    int i = 0; // ebp - 0xc
    printf("IP: ");
    fgets(ip, 0x20, stdin);
    ip[strlen(ip)] = 0;
    // looks like locals are allocated with alloca here?
    while(1) {
        if(time(0) == 0x58684680) {
            /*
            $ python -c 'print 0x58684680'
            1483228800
            $ date --date='@1483228800'
            Sat Dec 31 19:00:00 EST 2016
            */
            admin();
        }
        short port = rand() % (2**16+1); // unseeded
        i = loop(port, &i);
    }
}

int loop(short port, int* i) {
    char buf[0x108];
    memset(buf, 0, sizeof buf); // inlined
    if(DEBUG) {
        printf("PORT: %d\n", port);
    }
    read_server(port);
    strcpy(&buf[i], buff);
}

extern void read_server(short port); // connects to port and reads 0x40 bytes (or until newline) into buff, details (hopefully) irrelevant
